# Student-Faculty Assignment Routing System

## Overview

This document describes the implementation of the student-faculty assignment routing system that ensures student uploads are delivered to selected faculty members only, and faculty can view only their assigned assessments.

## Implementation Details

### 1. Database Schema

The system uses a `student_uploads` table to store assignment metadata with proper relationships:

```sql
CREATE TABLE IF NOT EXISTS student_uploads (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  student_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  faculty_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  title VARCHAR(255),
  description TEXT,
  file_path VARCHAR(1024) NOT NULL,
  original_filename VARCHAR(512),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  status VARCHAR(50) DEFAULT 'submitted',
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes for performance
CREATE INDEX IF NOT EXISTS idx_student_uploads_faculty ON student_uploads(faculty_id);
CREATE INDEX IF NOT EXISTS idx_student_uploads_student ON student_uploads(student_id);
CREATE INDEX IF NOT EXISTS idx_student_uploads_created_at ON student_uploads(created_at DESC);
```

Additionally, a `profiles` table is used to store user information:

```sql
CREATE TABLE IF NOT EXISTS profiles (
  id UUID REFERENCES auth.users(id) ON DELETE CASCADE PRIMARY KEY,
  full_name TEXT,
  email TEXT UNIQUE,
  role TEXT DEFAULT 'student',
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes for performance
CREATE INDEX IF NOT EXISTS idx_profiles_role ON profiles(role);
```

### 2. Security Policies

Row Level Security (RLS) is enabled with the following policies:

- Students can only view and insert their own uploads
- Faculty can only view and update uploads assigned to them
- Admins have full access to all uploads
- Users can only view their own profile
- Users can update their own profile

### 3. Frontend Services

#### Upload Service (`src/services/uploadService.ts`)

Provides functions for:
- Uploading assignments with faculty selection
- Retrieving student's upload history
- Retrieving faculty's assigned uploads
- Updating upload status (approve/reject)
- Fetching faculty list for selection

#### Student Upload Module (`src/components/StudentUploadModule.tsx`)

Features:
- Form for submitting assignments with title, description, and faculty selection
- File upload with validation
- Submission history display
- Integration with upload service
- Proper error handling and user feedback

#### Faculty Dashboard Module (`src/components/FacultyDashboardModule.tsx`)

Features:
- List of assignments assigned to the logged-in faculty member
- Search and filter capabilities
- Ability to approve or reject submissions
- Status tracking for all assignments

### 4. Data Flow

1. **Student Submission**:
   - Student selects faculty from dropdown (populated from faculty list)
   - Student uploads file with metadata
   - File is stored in Supabase storage
   - Metadata is stored in `student_uploads` table with faculty_id

2. **Faculty Review**:
   - Faculty logs in and accesses their dashboard
   - System retrieves uploads where faculty_id matches logged-in user
   - Faculty can approve/reject submissions
   - Status updates are persisted to database

### 5. Security Measures

- Row Level Security ensures data isolation
- Faculty can only access uploads assigned to them
- Students can only access their own uploads
- File storage is separate from database with access controls
- All operations are authenticated through Supabase Auth

### 6. Testing

The system has been tested to ensure:
- Students can only see their own submission history
- Faculty can only see uploads assigned to them
- Uploads are properly routed based on faculty selection
- Status updates work correctly
- File storage and retrieval functions properly

## Usage Instructions

### For Students:
1. Navigate to the "My Uploads" section
2. Fill in assignment title and description
3. Select the faculty member from the dropdown
4. Choose a file to upload
5. Click "Submit Assignment"
6. View submission status in the history section

### For Faculty:
1. Navigate to the "Student Submissions" section
2. View all assignments assigned to you
3. Use search and filter options to find specific submissions
4. Review submissions and click "Approve" or "Reject" as appropriate
5. Approved submissions will show as "Approved" to students
6. Rejected submissions will show as "Rejected" to students

## Database Migrations

The system includes the following database migrations:

1. `20230619000000_create_profiles_table.sql` - Creates the profiles table for user information
2. `20230620000000_student_uploads.sql` - Creates the student_uploads table for assignment submissions
3. `20230620000001_create_faculty_profiles.sql` - Inserts sample faculty profiles for testing

## Future Enhancements

- Email notifications for new submissions
- File type validation
- Assignment due dates and reminders
- Bulk operations for faculty
- Detailed analytics and reporting